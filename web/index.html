<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•Webæ–‡ä»¶æœåŠ¡å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: 3px solid #007acc;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .feature {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007acc;
            border-radius: 5px;
        }
        .button {
            display: inline-block;
            background: #007acc;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .button:hover {
            background: #005a9e;
        }
        .button.disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
        }
        code {
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .status-indicator {
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .status-enabled {
            color: #28a745;
        }
        .status-disabled {
            color: #dc3545;
        }
        .status-readonly {
            color: #ffc107;
        }
        .loading {
            color: #6c757d;
        }
        .hidden {
            display: none;
        }
        .webdav-info {
            background: #e7f3ff;
            border-left: 4px solid #007acc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ç®€å•Webæ–‡ä»¶æœåŠ¡å™¨</h1>

        <p>æ¬¢è¿ä½¿ç”¨è¿™ä¸ªç®€å•è€Œå®ç”¨çš„Webæ–‡ä»¶æœåŠ¡å™¨ï¼è¿™æ˜¯ä¸€ä¸ªç”¨Goè¯­è¨€ç¼–å†™çš„è½»é‡çº§æ–‡ä»¶ç®¡ç†å·¥å…·ã€‚</p>

        <h2>ğŸ“‹ é¡¹ç›®åŠŸèƒ½</h2>

        <div class="feature">
            <strong>ğŸ“ é™æ€æ–‡ä»¶æœåŠ¡</strong><br>
            è‡ªåŠ¨æœåŠ¡webç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ”¯æŒHTMLã€CSSã€JavaScriptã€å›¾ç‰‡ç­‰å„ç§æ–‡ä»¶ç±»å‹ã€‚
        </div>

        <div class="feature">
            <strong>ğŸ“¤ æ–‡ä»¶ä¸Šä¼ </strong><br>
            <span id="upload-feature-description">æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å¯ç”¨ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰å…¨ã€‚</span>
            <span id="upload-status" class="status-indicator loading">ğŸ”„ æ£€æŸ¥ä¸­...</span>
        </div>

        <div class="feature">
            <strong>ğŸŒ WebDAVæœåŠ¡</strong><br>
            <span id="webdav-feature-description">WebDAVæœåŠ¡å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å¯ç”¨ï¼Œæ”¯æŒæ–‡ä»¶ç®¡ç†å®¢æˆ·ç«¯è¿æ¥ã€‚</span>
            <span id="webdav-status" class="status-indicator loading">ğŸ”„ æ£€æŸ¥ä¸­...</span>
            <div id="webdav-info" class="webdav-info hidden">
                <strong>WebDAVåœ°å€:</strong> <code id="webdav-url">http://localhost:8080/webdav</code><br>
                <strong>æŒ‚è½½ç›®å½•:</strong> <code id="webdav-directory">.</code><br>
                <strong>è®¿é—®æ¨¡å¼:</strong> <span id="webdav-mode">è¯»å†™</span>
            </div>
        </div>

        <div class="feature">
            <strong>ğŸ“‚ ç›®å½•æµè§ˆ</strong><br>
            å½“æ²¡æœ‰é»˜è®¤é¡µé¢æ—¶ï¼Œè‡ªåŠ¨æ˜¾ç¤ºç›®å½•å†…å®¹ï¼Œæ–¹ä¾¿æµè§ˆå’Œä¸‹è½½æ–‡ä»¶ã€‚
        </div>

        <div class="feature">
            <strong>ğŸ”§ è‡ªåŠ¨é…ç½®</strong><br>
            è‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å³å¯ä½¿ç”¨ã€‚
        </div>

        <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>

        <div id="upload-section">
            <p><strong>æ–‡ä»¶ä¸Šä¼ ï¼š</strong></p>
            <div id="upload-enabled-content" class="hidden">
                <a href="/upload" class="button" id="upload-button">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</a>
            </div>
            <div id="upload-disabled-content" class="hidden">
                <p>è¦å¯ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š</p>
                <code>sweb.exe -upload</code> æˆ– <code>sweb.exe --enable-upload</code>
                <br><br>
                <a href="/upload" class="button disabled" id="upload-button-disabled">ğŸ“¤ ä¸Šä¼ åŠŸèƒ½å·²ç¦ç”¨</a>
            </div>
        </div>

        <div id="webdav-section">
            <p><strong>WebDAVæœåŠ¡ï¼š</strong></p>
            <div id="webdav-enabled-content" class="hidden">
                <a href="/webdav" class="button" id="webdav-button">ğŸŒ è®¿é—®WebDAV</a>
                <p><small>å¯ä»¥åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ·»åŠ ç½‘ç»œä½ç½®ï¼š<code id="webdav-mount-url">http://localhost:8080/webdav</code></small></p>
            </div>
            <div id="webdav-disabled-content" class="hidden">
                <p>è¦å¯ç”¨WebDAVæœåŠ¡ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š</p>
                <code>sweb.exe -webdav</code> æˆ– <code>sweb.exe --enable-webdav</code>
                <br><br>
                <a href="/webdav" class="button disabled" id="webdav-button-disabled">ğŸŒ WebDAVæœåŠ¡å·²ç¦ç”¨</a>
            </div>
        </div>

        <p><strong>æœåŠ¡å™¨ä¿¡æ¯ï¼š</strong></p>
        <ul>
            <li>æœåŠ¡ç«¯å£: <code>8080</code></li>
            <li>æ–‡ä»¶ç›®å½•: <code>./web</code></li>
            <li>ä¸Šä¼ åœ°å€: <code>/upload</code></li>
            <li>WebDAVåœ°å€: <code>/webdav</code></li>
        </ul>

        <h2>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h2>
        <div id="usage-instructions">
            <div id="usage-upload-enabled" class="hidden">
                <h3>æ–‡ä»¶ä¸Šä¼ </h3>
                <ol>
                    <li><strong>ä¸Šä¼ æ–‡ä»¶</strong>ï¼šç‚¹å‡»ä¸Šæ–¹çš„"ä¸Šä¼ æ–‡ä»¶"æŒ‰é’®ï¼Œé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶</li>
                    <li><strong>è®¿é—®æ–‡ä»¶</strong>ï¼šä¸Šä¼ æˆåŠŸåï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨webç›®å½•ä¸‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡URLè®¿é—®</li>
                    <li><strong>ç®¡ç†æ–‡ä»¶</strong>ï¼šæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºåœ¨ä¸»é¡µçš„æ–‡ä»¶åˆ—è¡¨ä¸­</li>
                </ol>
            </div>
            <div id="usage-webdav-enabled" class="hidden">
                <h3>WebDAVæœåŠ¡</h3>
                <ol>
                    <li><strong>Windows</strong>ï¼šåœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­ï¼Œå³é”®"æ­¤ç”µè„‘" â†’ "æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨" â†’ è¾“å…¥WebDAVåœ°å€</li>
                    <li><strong>macOS</strong>ï¼šåœ¨Finderä¸­ï¼ŒæŒ‰Cmd+K â†’ è¾“å…¥WebDAVåœ°å€</li>
                    <li><strong>Linux</strong>ï¼šä½¿ç”¨davfs2æˆ–å…¶ä»–WebDAVå®¢æˆ·ç«¯æŒ‚è½½</li>
                    <li><strong>ç§»åŠ¨è®¾å¤‡</strong>ï¼šä½¿ç”¨æ”¯æŒWebDAVçš„æ–‡ä»¶ç®¡ç†åº”ç”¨</li>
                </ol>
            </div>
            <div id="usage-disabled" class="hidden">
                <ol>
                    <li><strong>å¯ç”¨åŠŸèƒ½</strong>ï¼šä½¿ç”¨ç›¸åº”çš„å‘½ä»¤è¡Œå‚æ•°å¯åŠ¨æœåŠ¡å™¨</li>
                    <li><strong>æµè§ˆæ–‡ä»¶</strong>ï¼šå½“å‰å¯ä»¥æµè§ˆå’Œä¸‹è½½webç›®å½•ä¸­çš„ç°æœ‰æ–‡ä»¶</li>
                    <li><strong>å®‰å…¨è€ƒè™‘</strong>ï¼šé«˜çº§åŠŸèƒ½é»˜è®¤ç¦ç”¨ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰å…¨</li>
                </ol>
            </div>
        </div>

        <h2>ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§</h2>

        <ul>
            <li>ä½¿ç”¨Goè¯­è¨€æ ‡å‡†åº“å¼€å‘ï¼Œè½»é‡çº§æ— å¤–éƒ¨ä¾èµ–</li>
            <li>æ”¯æŒå¤šéƒ¨åˆ†è¡¨å•æ•°æ®ä¸Šä¼ </li>
            <li>å®Œæ•´çš„WebDAVåè®®æ”¯æŒï¼ˆRFC 4918ï¼‰</li>
            <li>å¯é…ç½®çš„è¯»å†™æƒé™æ§åˆ¶</li>
            <li>è‡ªåŠ¨MIMEç±»å‹æ£€æµ‹</li>
            <li>UTF-8ç¼–ç æ”¯æŒï¼Œå®Œç¾å¤„ç†ä¸­æ–‡</li>
            <li>è·¨å¹³å°å…¼å®¹ï¼ˆWindowsã€Linuxã€macOSï¼‰</li>
        </ul>

        <div class="footer">
            <p>ğŸ”— <strong>ç®€å•Webæ–‡ä»¶æœåŠ¡å™¨</strong> | åŸºäºGoè¯­è¨€å¼€å‘</p>
            <div id="footer-content">
                <div id="footer-enabled" class="hidden">
                    <p>å¼€å§‹ä½¿ç”¨ï¼š
                        <span id="footer-upload-link" class="hidden"><a href="/upload" class="button">ä¸Šä¼ æ–‡ä»¶</a></span>
                        <span id="footer-webdav-link" class="hidden"><a href="/webdav" class="button">è®¿é—®WebDAV</a></span>
                    </p>
                </div>
                <div id="footer-disabled" class="hidden">
                    <p>å®‰å…¨æ¨¡å¼ï¼šé«˜çº§åŠŸèƒ½å·²ç¦ç”¨</p>
                    <p>ä½¿ç”¨ <code>sweb.exe -help</code> æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¡¹</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        function checkServiceStatus() {
            fetch('/api/upload-status')
                .then(response => response.json())
                .then(data => {
                    updateUploadStatus(data.upload);
                    updateWebDAVStatus(data.webdav);
                    updateUsageInstructions(data.upload, data.webdav);
                })
                .catch(error => {
                    console.error('æ£€æŸ¥æœåŠ¡çŠ¶æ€å¤±è´¥:', error);
                    // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œæ˜¾ç¤ºé»˜è®¤çš„ç¦ç”¨çŠ¶æ€
                    updateUploadStatus({enabled: false, status: 'disabled'});
                    updateWebDAVStatus({enabled: false, status: 'disabled'});
                    updateUsageInstructions({enabled: false}, {enabled: false});
                });
        }

        // æ›´æ–°é¡µé¢ä¸Šçš„ä¸Šä¼ çŠ¶æ€æ˜¾ç¤º
        function updateUploadStatus(uploadData) {
            const statusElement = document.getElementById('upload-status');
            const descriptionElement = document.getElementById('upload-feature-description');
            const uploadEnabledContent = document.getElementById('upload-enabled-content');
            const uploadDisabledContent = document.getElementById('upload-disabled-content');

            if (uploadData.enabled) {
                statusElement.textContent = 'âœ… å·²å¯ç”¨';
                statusElement.className = 'status-indicator status-enabled';
                descriptionElement.textContent = 'é€šè¿‡ç®€å•çš„Webç•Œé¢ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œæ”¯æŒå„ç§æ–‡ä»¶æ ¼å¼ã€‚';

                uploadEnabledContent.classList.remove('hidden');
                uploadDisabledContent.classList.add('hidden');
            } else {
                statusElement.textContent = 'ğŸ”’ å·²ç¦ç”¨';
                statusElement.className = 'status-indicator status-disabled';
                descriptionElement.textContent = 'æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å¯ç”¨ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰å…¨ã€‚';

                uploadEnabledContent.classList.add('hidden');
                uploadDisabledContent.classList.remove('hidden');
            }
        }

        // æ›´æ–°é¡µé¢ä¸Šçš„WebDAVçŠ¶æ€æ˜¾ç¤º
        function updateWebDAVStatus(webdavData) {
            const statusElement = document.getElementById('webdav-status');
            const descriptionElement = document.getElementById('webdav-feature-description');
            const webdavEnabledContent = document.getElementById('webdav-enabled-content');
            const webdavDisabledContent = document.getElementById('webdav-disabled-content');
            const webdavInfo = document.getElementById('webdav-info');
            const webdavDirectory = document.getElementById('webdav-directory');
            const webdavMode = document.getElementById('webdav-mode');

            if (webdavData.enabled) {
                if (webdavData.readonly) {
                    statusElement.textContent = 'ğŸ“– åªè¯»æ¨¡å¼';
                    statusElement.className = 'status-indicator status-readonly';
                    descriptionElement.textContent = 'WebDAVæœåŠ¡å·²å¯ç”¨ï¼ˆåªè¯»æ¨¡å¼ï¼‰ï¼Œæ”¯æŒæ–‡ä»¶æµè§ˆå’Œä¸‹è½½ã€‚';
                    webdavMode.textContent = 'åªè¯»';
                } else {
                    statusElement.textContent = 'âœ… è¯»å†™æ¨¡å¼';
                    statusElement.className = 'status-indicator status-enabled';
                    descriptionElement.textContent = 'WebDAVæœåŠ¡å·²å¯ç”¨ï¼ˆè¯»å†™æ¨¡å¼ï¼‰ï¼Œæ”¯æŒå®Œæ•´çš„æ–‡ä»¶ç®¡ç†æ“ä½œã€‚';
                    webdavMode.textContent = 'è¯»å†™';
                }

                webdavDirectory.textContent = webdavData.directory || '.';
                webdavInfo.classList.remove('hidden');
                webdavEnabledContent.classList.remove('hidden');
                webdavDisabledContent.classList.add('hidden');
            } else {
                statusElement.textContent = 'ğŸ”’ å·²ç¦ç”¨';
                statusElement.className = 'status-indicator status-disabled';
                descriptionElement.textContent = 'WebDAVæœåŠ¡å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å¯ç”¨ï¼Œæ”¯æŒæ–‡ä»¶ç®¡ç†å®¢æˆ·ç«¯è¿æ¥ã€‚';

                webdavInfo.classList.add('hidden');
                webdavEnabledContent.classList.add('hidden');
                webdavDisabledContent.classList.remove('hidden');
            }
        }

        // æ›´æ–°ä½¿ç”¨è¯´æ˜å’Œé¡µè„š
        function updateUsageInstructions(uploadData, webdavData) {
            const usageUploadEnabled = document.getElementById('usage-upload-enabled');
            const usageWebdavEnabled = document.getElementById('usage-webdav-enabled');
            const usageDisabled = document.getElementById('usage-disabled');
            const footerEnabled = document.getElementById('footer-enabled');
            const footerDisabled = document.getElementById('footer-disabled');
            const footerUploadLink = document.getElementById('footer-upload-link');
            const footerWebdavLink = document.getElementById('footer-webdav-link');

            const anyEnabled = uploadData.enabled || webdavData.enabled;

            if (anyEnabled) {
                footerEnabled.classList.remove('hidden');
                footerDisabled.classList.add('hidden');
                usageDisabled.classList.add('hidden');

                if (uploadData.enabled) {
                    usageUploadEnabled.classList.remove('hidden');
                    footerUploadLink.classList.remove('hidden');
                } else {
                    usageUploadEnabled.classList.add('hidden');
                    footerUploadLink.classList.add('hidden');
                }

                if (webdavData.enabled) {
                    usageWebdavEnabled.classList.remove('hidden');
                    footerWebdavLink.classList.remove('hidden');
                } else {
                    usageWebdavEnabled.classList.add('hidden');
                    footerWebdavLink.classList.add('hidden');
                }
            } else {
                footerEnabled.classList.add('hidden');
                footerDisabled.classList.remove('hidden');
                usageDisabled.classList.remove('hidden');
                usageUploadEnabled.classList.add('hidden');
                usageWebdavEnabled.classList.add('hidden');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkServiceStatus();

            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
            setInterval(checkServiceStatus, 30000);
        });
    </script>
</body>
</html>